<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AR Filter Simulation</title>
  <style>
    :root {
      --bg: #0a0a0a;
      --fg: #fff;
      --muted: #b3b3b3;
      --accent: #ff2d55;
      --ig-grad-a: #fdd6d1;
      --ig-grad-b: #ffe8d0;
    }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); font-family: system-ui, sans-serif; }
    .app { display: grid; place-items: center; min-height: 100%; padding: 16px; }

    .phone {
      width: min(420px, 92vw);
      aspect-ratio: 9/19.5;
      background: #000;
      border-radius: 28px;
      box-shadow: 0 10px 40px rgba(0,0,0,.6);
      position: relative;
      overflow: hidden;
    }
    .notch { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 38%; height: 28px; background: #000; border-bottom-left-radius: 14px; border-bottom-right-radius: 14px; }

    .skin { position: absolute; inset: 0; display: grid; grid-template-rows: 44px 1fr 72px; }
    .skin.tiktok { background: #000; }
    .skin.instagram { background: linear-gradient(180deg, var(--ig-grad-a), var(--ig-grad-b)); color: #111; }

    .topbar { display: flex; align-items: center; justify-content: center; position: relative; font-weight: 600; }
    .timer { font-variant-numeric: tabular-nums; }
    .meta { position: absolute; left: 12px; font-size: 12px; color: var(--muted); }

    .video-wrap { position: relative; margin: 0 auto; height: 100%; display: grid; place-items: center; }
    .video-frame { width: 88%; aspect-ratio: 9/16; background: #111; border-radius: 12px; overflow: hidden; }
    .placeholder { display: grid; place-items: center; width: 100%; height: 100%; color: #888; font-size: 14px; }

    .side { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); display: grid; gap: 14px; }
    .icon { width: 28px; height: 28px; border-radius: 50%; background: rgba(255,255,255,.08); display: grid; place-items: center; font-size: 14px; color: #fff; }

    .bottombar { display: flex; align-items: center; justify-content: center; gap: 22px; }
    .capture { width: 54px; height: 54px; border-radius: 50%; border: 3px solid var(--accent); background: transparent; }

    .overlay { position: absolute; inset: 0; background: rgba(0,0,0,.74); display: none; }
    .overlay.show { display: grid; place-items: center; padding: 24px; }
    .card { width: min(360px, 92%); background: #111; color: #fff; border-radius: 14px; padding: 20px; }
    .card h2 { margin: 0 0 10px; font-size: 18px; }
    .opts { display: grid; gap: 12px; margin-top: 10px; }
    .btn { padding: 12px; border-radius: 10px; background: #1f6feb; color: white; font-weight: 600; cursor: pointer; border: none; }
    .btn.secondary { background: #2a2a2a; }
    .muted { color: var(--muted); font-size: 12px; }
    .toast { position: absolute; top: 56px; right: 12px; background: rgba(0,0,0,.6); color: #fff; padding: 6px 10px; border-radius: 8px; font-size: 12px; }
  </style>
</head>
<body>
  <!-- Selfie uploader (shown first) -->
<div id="uploader" style="display:grid; gap:12px; place-items:center; padding:16px;">
  <h3 style="margin:8px 0 0;">Take/Upload a Selfie</h3>
  <p style="margin:0; color:#b3b3b3; font-size:14px;">Front camera, portrait, neutral lighting. No stickers or text.</p>
  <input id="selfieInput" type="file" accept="image/*" capture="user" style="margin-top:8px;">
  <button id="startBtn" disabled style="padding:10px 14px; border-radius:10px; font-weight:600; background:#1f6feb; color:#fff; border:0; cursor:not-allowed;">Start exposure</button>
</div>

  <div class="app">
    <div class="phone" id="phone" style="display:none;">
      <div class="notch"></div>
      <div class="skin tiktok" id="skin">
        <div class="topbar">
          <div class="meta" id="meta">Condition: TikTok ¬∑ Playful</div>
          <div class="timer" id="timer">1:00</div>
<div class="video-wrap">
  <div class="video-frame">
    <!-- Selfie display goes here -->
    <img id="selfie" alt="Selfie" style="width:100%; height:100%; object-fit:cover;">
    
    <!-- Filter overlays -->
    <div id="playfulOverlay" style="display:none; position:absolute; inset:0; pointer-events:none;">
      <!-- Fun tint + emojis -->
      <div style="position:absolute; inset:0; background:rgba(255,200,50,0.08);"></div>
      <div style="position:absolute; inset:0; animation:hue 5s linear infinite;"></div>
      <div style="position:absolute; right:12px; top:12px; font-size:28px;">‚ú®</div>
      <div style="position:absolute; left:18px; bottom:18px; font-size:28px;">üòú</div>
    </div>

    <div id="realisticOverlay" style="display:none; position:absolute; inset:0; pointer-events:none;">
      <!-- Beauty vibe -->
      <div style="position:absolute; inset:0; background:radial-gradient(ellipse at center, rgba(255,255,255,0.08) 0%, rgba(0,0,0,0.18) 85%);"></div>
    </div>
  </div>
</div>

<!-- Filter overlays (we toggle one of these by condition) -->
<div id="playfulOverlay" style="display:none; position:absolute; inset:0; pointer-events:none;">
  <!-- fun tint + subtle hue wiggle + floating emojis -->
  <div style="position:absolute; inset:0; background:rgba(255,200,50,0.08);"></div>
  <div style="position:absolute; inset:0; animation: hue 5s linear infinite;"></div>
  <div style="position:absolute; right:12px; top:12px; font-size:28px;">‚ú®</div>
  <div style="position:absolute; left:18px; bottom:18px; font-size:28px;">üò∫</div>
</div>

<div id="realisticOverlay" style="display:none; position:absolute; inset:0; pointer-events:none;">
  <!-- soft beauty vibe: gentle contrast/saturation + vignette -->
  <div style="position:absolute; inset:0; background:radial-gradient(ellipse at center, rgba(255,255,255,0.08) 0%, rgba(0,0,0,0.18) 85%);"></div>
</div>

<style>
@keyframes hue { from{ filter:hue-rotate(0deg);} to{ filter:hue-rotate(360deg);} }
</style>
          </div>
          <div class="side" id="sideIcons">
            <div class="icon">‚ù§</div>
            <div class="icon">üí¨</div>
            <div class="icon">‚Üó</div>
          </div>
        </div>
        <div class="bottombar">
          <div class="capture"></div>
        </div>
        <div class="overlay" id="overlay">
          <div class="card">
            <h2>Manipulation Check</h2>
            <p>The filter you just saw felt‚Ä¶</p>
            <div class="opts">
              <label><input type="radio" name="mc" value="Playful" /> Playful</label>
              <label><input type="radio" name="mc" value="Realistic" /> Realistic</label>
            </div>
            <button class="btn" id="submitBtn">Continue</button>
          </div>
        </div>
        <div class="toast hidden" id="toast"></div>
      </div>
    </div>
  </div>

  <script>
    const qs = new URLSearchParams(location.search);
    const platform = (qs.get('platform') || 'tiktok').toLowerCase();
    const filterType = (qs.get('filter') || 'playful').toLowerCase();

    const selfieImg = document.getElementById('selfie');
    const playfulOverlay = document.getElementById('playfulOverlay');
    const realisticOverlay = document.getElementById('realisticOverlay');


    const skin = document.getElementById('skin');
    const meta = document.getElementById('meta');
    const timerEl = document.getElementById('timer');
    const overlay = document.getElementById('overlay');
    const submitBtn = document.getElementById('submitBtn');

    const uploader = document.getElementById('uploader');
    const selfieInput = document.getElementById('selfieInput');
    const startBtn = document.getElementById('startBtn');
    const phoneEl = document.getElementById('phone');
    const playfulOverlay = document.getElementById('playfulOverlay');
    const realisticOverlay = document.getElementById('realisticOverlay');

// Show selfie preview + enable start button
selfieInput.addEventListener('change', () => {
    const file = selfieInput.files && selfieInput.files[0];
    console.log("üì∏ File selected:", file);

    if (!file) {
        console.log("‚ùå No file detected");
        return;
    }

    const reader = new FileReader();
    reader.onload = e => {
        selfieImg.src = e.target.result;
        selfieImg.style.display = 'block';
        console.log("‚úÖ Selfie preview loaded");

        // Enable start button
        startBtn.disabled = false;
        startBtn.removeAttribute('disabled');
        startBtn.style.cursor = 'pointer';
        startBtn.style.opacity = '1';
        console.log("‚úÖ Start button enabled");
    };
    reader.readAsDataURL(file);
});

// When Start clicked ‚Üí show phone + apply overlay + begin timer
startBtn.addEventListener('click', () => {
  uploader.style.display = 'none';
  phoneEl.style.display = 'block';

  applySkin(); // keep using your existing function
  if (filterType === 'playful') {
    playfulOverlay.style.display = 'block';
    realisticOverlay.style.display = 'none';
  } else {
    realisticOverlay.style.display = 'block';
    playfulOverlay.style.display = 'none';
  }

  if (filterType === 'playful') {
    playfulOverlay.style.display = 'block';
    realisticOverlay.style.display = 'none';
  } else {
    realisticOverlay.style.display = 'block';
    playfulOverlay.style.display = 'none';
  }

  remaining = 60;  // reset to 1 minute
  startTimer();     // call your existing timer function
});

    function applySkin(){
      if(platform === 'instagram'){
        skin.classList.remove('tiktok');
        skin.classList.add('instagram');
      }
      meta.textContent = `${platform.charAt(0).toUpperCase()+platform.slice(1)} ¬∑ ${filterType.charAt(0).toUpperCase()+filterType.slice(1)}`;
    }

    let remaining = 60;
    timerEl.textContent = "1:00";
    const iv = setInterval(()=>{
      remaining--;
      let m = Math.floor(remaining/60), s = remaining%60;
      timerEl.textContent = `${m}:${String(s).padStart(2,'0')}`;
      if(remaining <= 0){ clearInterval(iv); overlay.classList.add('show'); }
    },1000);

    submitBtn.addEventListener('click', ()=>{
      alert("Response submitted! (Here you would redirect to Qualtrics)");
    });

    applySkin();
  </script>
</body>
</html>
