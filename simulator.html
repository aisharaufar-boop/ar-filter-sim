<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AR Filter Simulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    margin:0; min-height:100vh; display:grid; place-items:center;
    background:#000; color:#fff; font-family:Arial, sans-serif;
  }
  #uploader { text-align:center; }
  #uploader button {
    margin-top:10px; padding:10px 14px; border:0; border-radius:8px;
    background:#1f6feb; color:#fff; font-weight:700;
    cursor:not-allowed; opacity:.6;
  }
  #uploader button.enabled { cursor:pointer; opacity:1; }
  #phone {
    display:none; position:relative; width:320px; height:500px;
    border-radius:28px; overflow:hidden; background:#111;
    border:6px solid hotpink;
  }
  #selfie {
    width:100%; height:100%; object-fit:cover; display:block;
    transition:filter .25s ease;
  }
  #overlaySvg {
    position:absolute; inset:0; width:100%; height:100%;
    pointer-events:none; z-index:2;
  }
  #timer {
    position:absolute; top:10px; left:10px; z-index:3;
    background:rgba(0,0,0,.55); padding:5px 10px;
    border-radius:8px; font-weight:700;
  }
</style>
</head>
<body>

<div id="uploader">
  <h2>Take/Upload a Selfie</h2>
  <input id="selfieInput" type="file" accept="image/*" capture="user" />
  <br />
  <button id="startBtn" disabled>Start Exposure</button>
</div>

<div id="phone">
  <img id="selfie" alt="Selfie" />
  <svg id="overlaySvg" viewBox="0 0 320 500" preserveAspectRatio="xMidYMid slice"></svg>
  <div id="timer">01:00</div>
</div>

<script>
  const input = document.getElementById('selfieInput');
  const startBtn = document.getElementById('startBtn');
  const uploader = document.getElementById('uploader');
  const phone = document.getElementById('phone');
  const img = document.getElementById('selfie');
  const svg = document.getElementById('overlaySvg');
  const timerEl = document.getElementById('timer');

  const qs = new URLSearchParams(location.search);
  const filterType = (qs.get('filter') || 'playful').toLowerCase();

  input.addEventListener('change', () => {
    const file = input.files && input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      img.src = e.target.result;
      startBtn.disabled = false;
      startBtn.classList.add('enabled');
    };
    reader.readAsDataURL(file);
  });

  startBtn.addEventListener('click', () => {
    if (startBtn.disabled) return;
    uploader.style.display = 'none';
    phone.style.display = 'block';
    applyFilter(filterType);
    startTimer();
  });

  function startTimer() {
    let remaining = 60;
    update();
    const iv = setInterval(() => {
      remaining--;
      update();
      if (remaining <= 0) clearInterval(iv);
    },1000);
    function update() {
      let m = String(Math.floor(remaining/60)).padStart(2,'0');
      let s = String(remaining%60).padStart(2,'0');
      timerEl.textContent = `${m}:${s}`;
    }
  }

  function applyFilter(type) {
    svg.innerHTML = '';
    img.style.filter = 'none';
    if (type==='playful') {
      renderPlayful();
    } else {
      renderRealistic();
    }
  }

  function renderPlayful() {
    // Pink tint background
    svg.innerHTML += `<rect width="320" height="500" fill="rgba(255,192,203,0.08)"></rect>`;
    // Dog ears
    svg.innerHTML += `<ellipse cx="70" cy="60" rx="40" ry="60" fill="saddlebrown"></ellipse>
                      <ellipse cx="250" cy="60" rx="40" ry="60" fill="saddlebrown"></ellipse>`;
    // Glasses
    svg.innerHTML += `<circle cx="120" cy="220" r="50" stroke="black" stroke-width="8" fill="none" />
                      <circle cx="200" cy="220" r="50" stroke="black" stroke-width="8" fill="none" />
                      <rect x="145" y="210" width="30" height="20" fill="black"/>`;
    // Crown
    svg.innerHTML += `<polygon points="90,90 120,40 150,90 180,40 210,90 210,120 90,120"
                      fill="gold" stroke="orange" stroke-width="4"></polygon>`;
    // Rainbow vomit
    svg.innerHTML += `<defs>
        <linearGradient id="rainbow" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="red"/>
          <stop offset="20%" stop-color="orange"/>
          <stop offset="40%" stop-color="yellow"/>
          <stop offset="60%" stop-color="green"/>
          <stop offset="80%" stop-color="blue"/>
          <stop offset="100%" stop-color="violet"/>
        </linearGradient>
      </defs>
      <rect x="145" y="250" width="30" height="220" fill="url(#rainbow)" opacity="0.8"></rect>`;
  }

  function renderRealistic() {
    // Subtle glow + vignette
    img.style.filter = 'brightness(1.1) contrast(1.08) saturate(1.05)';
    svg.innerHTML += `<radialGradient id="vig" cx="50%" cy="50%" r="70%">
        <stop offset="60%" stop-color="rgba(0,0,0,0)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0.35)"/>
      </radialGradient>
      <rect width="320" height="500" fill="url(#vig)"></rect>`;
    // Blush (cheeks)
    svg.innerHTML += `<ellipse cx="110" cy="300" rx="25" ry="15" fill="rgba(255,105,180,0.25)"/>
                      <ellipse cx="210" cy="300" rx="25" ry="15" fill="rgba(255,105,180,0.25)"/>`;
    // Lip tint
    svg.innerHTML += `<rect x="140" y="340" width="40" height="10" rx="5" fill="rgba(230,60,90,0.25)"/>`;
  }
</script>
</body>
</html>
