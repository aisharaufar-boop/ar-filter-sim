<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AR Filter Simulator</title>
  <style>
    body {
      margin: 0;
      background: #000;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .uploader {
      text-align: center;
    }

    .phone {
      width: 320px;
      height: 560px;
      background: #111;
      border-radius: 36px;
      border: 6px solid #222;
      position: relative;
      display: none;
      overflow: hidden;
    }

    .skin.tiktok {
      border: 6px solid #ff0050;
      box-shadow: 0 0 15px rgba(255,0,80,0.7);
    }

    .skin.instagram {
      border: 6px solid #e1306c;
      box-shadow: 0 0 15px rgba(225,48,108,0.7);
    }

    .topbar {
      position: absolute;
      top: 8px;
      left: 12px;
      font-size: 14px;
    }

    .timer {
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 14px;
    }

    .video-wrap {
      position: absolute;
      inset: 0;
    }

    #selfie {
      display: none;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
    }

    /* Overlays */
    #playfulOverlay, #realisticOverlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      display: none;
    }

    #playfulOverlay {
      background: rgba(255,200,50,0.05);
    }

    #playfulOverlay::after {
      content: "âœ¨ðŸ˜Šâœ¨";
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 28px;
      animation: wiggle 2s infinite;
    }

    #realisticOverlay {
      background: radial-gradient(circle at center, rgba(255,255,255,0.08) 0%, rgba(0,0,0,0.5) 85%);
    }

    @keyframes wiggle {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(10deg); }
    }
  </style>
</head>
<body>
  <!-- Upload screen -->
  <div class="uploader" id="uploader">
    <h2>Take/Upload a Selfie</h2>
    <p>Front camera, portrait, neutral lighting. No stickers or text.</p>
    <input id="selfieInput" type="file" accept="image/*" capture="user">
    <br><br>
    <button id="startBtn" disabled>Start exposure</button>
  </div>

  <!-- Phone simulation -->
  <div class="phone skin" id="phone">
    <div class="topbar" id="meta">Condition:</div>
    <div class="timer" id="timer">1:00</div>

    <div class="video-wrap">
      <img id="selfie" alt="Selfie">
      <div id="playfulOverlay"></div>
      <div id="realisticOverlay"></div>
    </div>
  </div>

  <script>
    // Parse query params
    const qs = new URLSearchParams(location.search);
    const platform = (qs.get('platform') || "tiktok").toLowerCase();
    const filterType = (qs.get('filter') || "playful").toLowerCase();

    // Elements
    const uploader = document.getElementById('uploader');
    const phoneEl = document.getElementById('phone');
    const startBtn = document.getElementById('startBtn');
    const selfieInput = document.getElementById('selfieInput');
    const selfieImg = document.getElementById('selfie');
    const metaEl = document.getElementById('meta');
    const timerEl = document.getElementById('timer');
    const playfulOverlay = document.getElementById('playfulOverlay');
    const realisticOverlay = document.getElementById('realisticOverlay');

    // Enable start when file chosen
    selfieInput.addEventListener('change', () => {
      const file = selfieInput.files && selfieInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = e => {
        selfieImg.src = e.target.result;
        selfieImg.style.display = "block";
        startBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    });

    // Timer
    function startTimer() {
      let remaining = 60;
      const iv = setInterval(() => {
        remaining--;
        timerEl.textContent = `0:${remaining < 10 ? "0" : ""}${remaining}`;
        if (remaining <= 0) clearInterval(iv);
      }, 1000);
    }

    // Start simulation
    startBtn.addEventListener('click', () => {
      uploader.style.display = "none";
      phoneEl.style.display = "block";

      // Apply platform skin
      if (platform === "instagram") {
        phoneEl.classList.add("instagram");
        phoneEl.classList.remove("tiktok");
      } else {
        phoneEl.classList.add("tiktok");
        phoneEl.classList.remove("instagram");
      }

      // Show correct overlay
      if (filterType === "playful") {
        playfulOverlay.style.display = "block";
        realisticOverlay.style.display = "none";
      } else {
        realisticOverlay.style.display = "block";
        playfulOverlay.style.display = "none";
      }

      // Update condition text
      metaEl.textContent = `Condition: ${platform} â€¢ ${filterType}`;

      // Start timer
      startTimer();
    });
  </script>
</body>
</html>
